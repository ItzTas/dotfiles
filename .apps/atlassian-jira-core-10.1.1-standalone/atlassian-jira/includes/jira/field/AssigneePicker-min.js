define("jira/field/assignee-picker",["jira/util/formatter","jira/ajs/select/single-select","jira/ajs/select/suggestions/assignee-suggest-handler","jira/ajs/list/group-descriptor","jira/ajs/list/item-descriptor","wrm/context-path","aui/params","jquery"],(function(e,s,t,i,a,r,n,u){"use strict";var o=r();return s.extend({init:function(s){var r=s.element instanceof u?s.element:u(s.element),l=!!r.data("use-new-endpoint");if("-1"===(s=u.extend(!0,{},{submitInputVal:!0,showDropdownButton:!!r.data("show-dropdown-button"),errorMessage:e.I18n.getText("assignee.picker.invalid.user"),localDataGroupId:"assignee-group-suggested",content:"mixed",iconType:"rounded",suggestionAtTop:!0,removeDuplicates:!1,disableRemoveSelected:!0,ajaxOptions:{url:function(){n.assigneeEditIssueKey=void 0;AJS.populateParameters();if(l)return"".concat(o).concat(n.assigneeEditIssueKey?"/rest/internal/2/users/assignee":"/rest/internal/2/users/assignee/multiProjectSearch");var e=n.assigneeEditIssueKey?"search":"multiProjectSearch";return"".concat(o,"/rest/api/latest/user/assignable/").concat(e)}(),minQueryLength:0,data:function(e){n.actionDescriptorId=void 0;AJS.populateParameters();var s={issueKey:n.assigneeEditIssueKey,actionDescriptorId:n.actionDescriptorId,maxResults:100};l&&n.assigneeEditIssueKey||(s.projectKeys=n.projectKeys);l?s.query=e:s.username=e;return s},formatResponse:function(s){var t=[],r=l?s.users:s;if(!r||0===r.length)return t;for(var n=new i({weight:1,id:"assignee-group-search",uniqueItemScope:"container",replace:!0,label:e.I18n.getText("assignee.picker.group.search")}),u=0,o=r.length;u<o;u++){var c=r[u],d=c.name,p=c.displayName,g=c.emailAddress,h=p;g&&(h+=" - "+g);h+=" ("+d+")";n.addItem(new a({value:d,fieldText:p,label:h,allowDuplicate:!0,icon:l?c.avatarUrl:c.avatarUrls["16x16"],iconType:"rounded"}))}t.push(n);return t}}},s)).editValue){s.editValue=!1;r.val("-1")}this._super(s);this.suggestionsHandler=new t(this.options,this.model)},handleFreeInput:function(e){""===u.trim(e||this.$field.val())?this.setSelection(this.model.getDescriptor("-1")):this._super(e);this.lastQuery=this.getQueryVal()},_handleCharacterInput:function(e){this.lastQuery!==this.getQueryVal()?this._super(e):e&&this.showSuggestions();this.lastQuery=this.getQueryVal()},cleanUpModel:function(){}})}));AJS.namespace("JIRA.AssigneePicker",null,require("jira/field/assignee-picker"));