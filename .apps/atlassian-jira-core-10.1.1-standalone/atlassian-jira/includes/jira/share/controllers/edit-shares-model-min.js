define("jira/share/controllers/edit-shares-model",["aui/message","jquery","jira/util/formatter"],(function(e,t,i){"use strict";function a(e){this.mode=e;this.counter=0;this.displayDiv=this.getModeElementById("share_display_div");this.emptyDiv=this.getModeElementById("empty_share");this.shareDiv=this.getModeElementById("share_div")}a.prototype={initialise:function(){var e=this.getModeElementById("share_busy");if(e){e.style.display="none";e.parentNode&&e.parentNode.removeChild(e)}this.shareDiv.style.display=""},setupDefaultShareType:function(){var e=this.getModeElementById("share_type_selector"),t=e.options[e.selectedIndex].value;this.getModeElementById("share_".concat(t)).style.display="";return t},onFilterEdit:function(e){if("viewers"===this.mode){var t=document.getElementById("share_type_hidden_editors");if(t)try{var i=JSON.parse(e.value);i.forEach((function(e){e.rights={value:1}}));var a=JSON.parse(t.value);a.forEach((function(e){e.rights={value:3}}));e.value=JSON.stringify(i.concat(a));t.parentNode.removeChild(t)}catch(e){console.log("Error parsing JSON data: "+e)}this.removeEditorsSelect("group-share");this.removeEditorsSelect("project-share");this.removeEditorsSelect("role-share")}},setWarning:function(t,i){var a=document.getElementById("share_warning");a&&(t.length>0?e.warning("#share_warning",{body:t,title:i,closeable:!1,shadowed:!1}):a.innerHTML="")},getModeElementById:function(e){return document.getElementById("".concat(e,"_").concat(this.mode))},removeEditorsSelect:function(e){var t=document.querySelector(".editors select.".concat(e));t&&t.parentNode.removeChild(t)},animateShare:function(e){var i=this.getModeElementById("share_div_".concat(e,"_inner"));if(i){for(var a=i.parentNode,r=null;!r&&a&&a!==document.body.parentNode;){a.style&&(r=a.style.backgroundColor);!r&&a.bgColor&&(r=a.bgColor);a=a.parentNode}r||(r="#FFFFFF");if(!t(i).hasClass("fading")){t(i).addClass("fading");t(i).css({backgroundColor:"#FFCCCC"}).animate({backgroundColor:"#FFFFFF"},2e3,(function(){t(i).removeClass("fading")}))}}},addDisplay:function(e,i,a){var r=this.counter++;i.className="shareItem";i.id="share_div_".concat(r,"_").concat(this.mode);var n=document.createElement("div"),s="share_div_"+r+"_inner_"+this.mode;n.id=s;n.title=e.description;var o=this.cloneImage("share_icon");o&&n.appendChild(o);var d=document.createElement("span");d.id=s+"_span";e.dataSpanId=d.id;d.innerHTML=e.display;n.appendChild(d);var l=this.cloneImage("share_trash");if(l){t(l).click((function(e){a(e,r)}));n.appendChild(l)}i.appendChild(n);this.appendToDisplayDiv(i);e.key&&e.updateDisplayName();return r},remove:function(e,t){var i=this.getModeElementById("share_div_".concat(e));if(t>=1)this.displayDiv.removeChild(i);else{i.innerHTML=this.emptyDiv.innerHTML;i.className=this.emptyDiv.className;i.removeAttribute("id")}},clearDiv:function(){for(;this.displayDiv.firstChild;){if("div"===this.displayDiv.firstChild.nodeName.toLowerCase()){for(var e=this.displayDiv.firstChild;e.nextSibling;)this.displayDiv.removeChild(e.nextSibling);return e}this.displayDiv.removeChild(this.displayDiv.firstChild)}},recalculateHiddenValue:function(e){var t=this.getModeElementById("share_type_hidden");if(t){var i=e.map((function(e){return e.permission}));t.value=JSON.stringify(i)}},appendToDisplayDiv:function(e){this.displayDiv.appendChild(e)},displayEmptySharesTemplate:function(){var e=this.emptyDiv.cloneNode(!0);e.removeAttribute("id");e.style.display="";this.appendToDisplayDiv(e)},getSelectedType:function(){for(var e,t=this.getModeElementById("share_type_selector"),i=t.options,a=0;a<i.length;a++){var r=this.getModeElementById("share_".concat(i[a].value));r&&(a===t.selectedIndex?e=r:r.style.display="none")}e.style.display="";return i[t.selectedIndex].value},cloneImage:function(e){var t=this.getModeElementById(e);if(t){(t=t.cloneNode(!0)).removeAttribute("id");t.style.display=""}return t},improveSelectArialabel:function(e,t){var i=e.closest("fieldset").find(".js-default-single-group-picker"),a=i.attr("aria-label");i.attr("aria-label",a+" "+t)},getSelectList:function(){return this.getModeElementById("share_type_selector")},getShareTypeSelector:function(){return t("#share_type_selector_".concat(this.mode))},getSubmitButton:function(){return this.getForm().find("input[type=submit]")},getForm:function(){if(void 0===t("body").data("loaded")){t("body").attr("data-loaded","loaded");var e=t("#share_type_selector_viewers"),a=t("#share_type_selector_editors");e.length&&this.improveSelectArialabel(e,i.I18n.getText("dashboard.create.select.group.viewers"));a.length&&this.improveSelectArialabel(a,i.I18n.getText("dashboard.create.select.group.editors"))}return t("#edit-entity")}};return a}));