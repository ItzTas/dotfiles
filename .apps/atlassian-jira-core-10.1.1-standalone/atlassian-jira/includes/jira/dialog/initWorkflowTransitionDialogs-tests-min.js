AJS.test.require(["jira.webresources:jira-global"],(function(){"use strict";var i=require("jquery"),t=require("jira/dialog/dialog-register");module("initDialog",{setup:function(){this.server=sinon.fakeServer.create();this.server.respondWith("GET",/.*WorkflowUIDispatcher.*/,[200,{"Content-Type":"text/html"},"-"])},teardown:function(){this.dialog&&this.dialog.hide();this.server.restore()},testTransitionLink:function(e,o,n){i(e).appendTo(i("#qunit-fixture"));i("#"+o).click();this.server.respond();this.dialog=t["workflow-transition-"+n+"-dialog"];ok(this.dialog,"Transition dialog shown");equal(this.dialog.$activeTrigger.attr("id"),"action_id_"+n,"Link is the $activeTrigger of the transition dialog")},testDialogInstancePersistence:function(e,o,n,a,s){var r="workflow-transition-".concat(n,"-dialog");i(e).appendTo(i("#qunit-fixture"));i("#".concat(a)).click();this.server.respond();var c=t[r];ok(i("#".concat(r))[0],"Dialog1 appended to DOM");c.hide();ok(!i("#".concat(r))[0],"Dialog1 removed from DOM");equal(c.options.isIssueDialog,!0);equal(c.options.refreshOnSubmit,!0);i(o).appendTo(i("#qunit-fixture"));i("#".concat(s)).click();this.server.respond();var l=t[r];ok(i("#".concat(r))[0],"Dialog2 appended to DOM");l.hide();ok(!i("#".concat(r))[0],"Dialog2 removed from DOM");equal(l.options.isIssueDialog,!1);equal(l.options.refreshOnSubmit,!1);notEqual(c,l)}});var e=function(i,t,e,o){return"<a id='".concat(i,"' class='issueaction-workflow-transition' href='/secure/WorkflowUIDispatcher.jspa?id=").concat(t,"&action=").concat(t,"' ").concat(o,">").concat(e,"</a>")};test("Workflow transition link handler called when clicked on a transition link",(function(){var i="action_id_1",t=e(i,"1","Test 1");this.testTransitionLink(t,i,"1")}));test("Workflow transition link handler called when clicked on a span inside transition link",(function(){var i="action_span_id_2",t=e("action_id_2","2","<span id='".concat(i,"' class='trigger-label'>Test 2</span>"));this.testTransitionLink(t,i,"2")}));test("New instance of form dialog created when same link is clicked multiple times",(function(){var i="action_id_1",t=e(i,"2","Issue view dialog"),o="action_id_2",n=e(o,"2","Some other dialog","is-issue-dialog='false' refresh-on-submit='false'");this.testDialogInstancePersistence(t,n,"2",i,o)}))}));