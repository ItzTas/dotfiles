AJS.test.require(["jira.webresources:user-can-attach-info"],(function(){"use strict";var t=require("jira/attachments/can-attach-manager"),e=require("wrm/context-path"),a=require("jquery");module("CanAttachManager",{setup:function(){},tearDown:function(){},beforeEach:function(){this.originalAjax=a.ajax;this.ajaxStub=function(){};a.ajax=this.ajaxStub},afterEach:function(){a.ajax=this.originalAjax}});test("canAttach() should return true when API response is true",(function(){var n="TEST";this.ajaxStub=function(t){t.url===e()+"/rest/internal/2/attachment-permission/attach?projectKey="+encodeURIComponent(n)&&t.success(!0)};a.ajax=this.ajaxStub;t.canAttach(n).then((function(t){equal(t,!0,"canAttach() returns true");start()}),(function(){ok(!1,"Promise should not be rejected");start()}));stop()}));test("canAttach() should return false when API response is false",(function(){var n="TEST";this.ajaxStub=function(t){t.url===e()+"/rest/internal/2/attachment-permission/attach?projectKey="+encodeURIComponent(n)&&t.success(!1)};a.ajax=this.ajaxStub;t.canAttach(n).then((function(t){equal(t,!1,"canAttach() returns false");start()}),(function(){ok(!1,"Promise should not be rejected");start()}));stop()}));test("canAttach() should return false when there is an error in the API call",(function(){var n="TEST";this.ajaxStub=function(t){t.url===e()+"/rest/internal/2/attachment-permission/attach?projectKey="+encodeURIComponent(n)&&t.error()};a.ajax=this.ajaxStub;t.canAttach(n).then((function(t){equal(t,!1,"canAttach() returns false");start()}),(function(){ok(!1,"Promise should not be rejected");start()}));stop()}));test("canAttach() should return false when projectKey is not provided",(function(){t.canAttach().then((function(t){equal(t,!1,"canAttach() returns false when projectKey is not provided");start()}),(function(){ok(!1,"Promise should not be rejected");start()}));stop()}))}));