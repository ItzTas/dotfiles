define("jira/setup/init-setup-page",["jira/ajs/select/single-select","jira/ajs/list/item-descriptor","underscore","jquery"],(function(e,a,t,i){"use strict";var n=window._gaq=window._gaq||[];return function(){var s=require("jira/setup/setup-tracker");s.insert();if(!i("body").hasClass("jira-setup-database-page")){i("#jira-setupwizard").submit((function(e){var a=i("body").hasClass("jira-setup-page-mail-notifications");if(a&&!i(this).data("intercepted")){e.preventDefault();i(this).data("intercepted",!0);setTimeout((function(){s.sendMailConfigurationEvent(function(){var e={emailProvider:"none"};if(i("#jira-setupwizard-email-notifications-disabled").is(":checked"))return e;var a,t=(a=i("select[name='serviceProvider']").val(),i.isArray(a)?a[0]:a);i.extend(e,{emailProvider:t});if("custom"===t){var n=i("#jira-setupwizard-email-notifications-smtp").is(":checked");if(n){var s=function(){var e=i("input[name='serverName']").val();return-1!==["mail","smtp","exchange"].indexOf(e)?e:""}(),r=function(){var e=i("input[name='serverName']").val().toLowerCase(),a=e.indexOf(".");e=-1!==a?e.substr(0,a):e;return-1!==["mail","smtp","exchange","mx","localhost"].indexOf(e)?e:""}();i.extend(e,{emailHostname:s,emailHostnameExt:r,emailPort:i("input[name='port']").val(),emailProtocol:function(){var e=i("select[name='protocol']").val();return i.isArray(e)?e[0]:e}()})}i.extend(e,{emailIsSMTP:n})}return e}()).always((function(){i("#jira-setupwizard").submit()}))}),0)}else if(a)return!0;i(["#jira-setupwizard-submit","#jira-setupwizard-test-connection","#jira-setupwizard-test-mailserver-connection","#jira-setupwizard-submit-instant","#jira-setupwizard-submit-classic"].join(", ")).attr("disabled","disabled");var t=i("#jira-setupwizard-server-language");t.length>0&&t.attr("disabled","disabled");i("input[name=nextStep]").val("true");!function(){"false"==i("input[name=changingLanguage]").val()&&"testconnection"==i("input[name=testingConnection]").val()||"true"==i("input[name=testingMailConnection]").val()?i("#test-connection-throbber").removeClass("hidden"):"false"!==i("input[name=changingLanguage]").val()&&"false"!==i("input[name=testingMailConnection]").val()||i("#submit-throbber").removeClass("hidden");i(".throbber-message").removeClass("hidden")}()}));var r={ports:{},schemas:{}};r.ports.postgres72="5432";r.schemas.postgres72="public";r.ports.postgresaurora96="5432";r.schemas.postgresaurora96="public";r.ports.mysql="3306";r.schemas.mysql="";r.ports.oracle10g="1521";r.schemas.oracle10g="";r.ports.mssql="1433";r.schemas.mssql="dbo";j();y();i("select[name=databaseType]").change((function(){var e=i(this).val(),a=i("input[name='jdbcPort']"),t=i("input[name='schemaName']");a.val(r.ports[e]);t.val(r.schemas[e]);j();y()}));i("#jira-setupwizard-test-connection").click((function(){i("input[name=changingLanguage]").val("false");i("input[name=testingConnection]").val("true");i("#jira-setupwizard").submit()}));i("#jira-setupwizard-server-language").change((function(){var e=i(this).val();i("input[name=language]").val(e);i("input[name=changingLanguage]").val("true");i("#jira-setupwizard").submit()}));i("#fetchLicense").click((function(){var e=i("#jira-setupwizard").serializeArray(),a=i(this).attr("data-url");i.post(a,e,(function(){return!1}))}));var o=i("#enableAnalytics");if(1==o.length){var l=i(".analytics-yes-please"),c=i(".analytics-no-thanks"),u=function(e){return function(a){a.preventDefault();o.val(e);i(this).closest("form").submit()}};l.click(u(!0));c.click(u(!1));t.defer((function(){l.blur()}))}var d=i('input[name="analytics-enabled"]');if(d.length>0&&"true"===d.val()){var p=document.createElement("script");p.type="text/javascript";p.async=!0;p.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var m=document.getElementsByTagName("script")[0];m.parentNode.insertBefore(p,m);n.push(["_setAccount","UA-20272869-4"]);n.push(["_setDomainName","none"]);n.push(["_setDetectTitle",!1]);var v="true"===d.val()?1:0;n.push(["_trackEvent","btf.analytics",v?"enable":"disable","JIRA",0])}i("#test-connection-messages").hide();i("input[name=noemail]").change((function(){var e="false"==i(this).val(),a=i("#setup-notification-fields"),t=i("#jira-setupwizard-test-mailserver-connection");if(e){a.removeClass("hidden");t.removeClass("hidden")}else{a.addClass("hidden");t.addClass("hidden")}}));"false"==i("input[name=noemail]:checked").val()&&i("#setup-notification-fields, #jira-setupwizard-test-mailserver-connection").removeClass("hidden");i("input[name=mailservertype]").change((function(){var e=i(this).val(),a=i(".setup-fields");if("smtp"==e){a.addClass("hidden");i("#email-notifications-smtp-fields").removeClass("hidden")}else{a.addClass("hidden");i("#email-notifications-jndi-fields").removeClass("hidden")}}));var f=i("input[name=mailservertype]:checked");if("smtp"==f.val()){i(".setup-fields").addClass("hidden");i("#email-notifications-smtp-fields").removeClass("hidden")}else if("jndi"==f.val()){i(".setup-fields").addClass("hidden");i("#email-notifications-jndi-fields").removeClass("hidden")}i("#jira-setupwizard-test-mailserver-connection").click((function(){i("input[name=testingMailConnection]").val("true");i("#jira-setupwizard").attr("action","VerifySmtpServerConnection!setup.jspa").submit()}));i("#reimport").click((function(e){e.preventDefault();i("#jira-setupwizard").submit()}));i("#acknowledgeDowngradeError").click((function(e){e.preventDefault();i("#acknowledgeDowngradeError").parent().parent().fadeOut();i("input[name=downgradeAnyway]").val("true")}));var g=i("select[name=serviceProvider]");if(g.length>0){var h=new a({value:"smtps",label:"SECURE_SMTP"}),b={"gmail-smtp":{protocol:h,serverName:"smtp.gmail.com",port:"465"},"yahooplus-smtp":{protocol:h,serverName:"plus.smtp.mail.yahoo.com",port:"465"}};new e({element:g});var w=new e({element:i("select[name=protocol]")});g.change(function(e){return function(){var a=i(this).val(),t=!1,n=i("input[name=serverName]"),s=i("input[name=port]"),r=i("input[name=tlsRequired]"),o=b[a];if(o){e.setSelection(o.protocol);n.val(o.serverName);s.val(o.port)}else t=!0;e.$container.parent(".field-group").toggle(t);n.parent(".field-group").toggle(t);s.parent(".field-group").toggle(t);r&&r.parent(".field-group").toggle(t)}}(w)).change()}else i(".select").each((function(){new e({element:this})}))}function j(){var e=i("select[name=databaseType]").val();if(""!=e){i(".setup-fields").addClass("hidden");i(".db-option-"+e).removeClass("hidden")}}function y(){var e=i("select[name=databaseType]"),a=e.parent().find(".description").empty(),t=e.val();""!=t&&e.parent().find(".descriptions ."+t).clone().appendTo(a)}}}));