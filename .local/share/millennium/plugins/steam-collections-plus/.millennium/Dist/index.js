const MILLENNIUM_IS_CLIENT_MODULE=!0,pluginName="steam-collections-plus";function InitializePlugins(){var e,t;let o;(e=window.PLUGIN_LIST||(window.PLUGIN_LIST={}))[pluginName]||(e[pluginName]={}),(t=window.MILLENNIUM_PLUGIN_SETTINGS_STORE||(window.MILLENNIUM_PLUGIN_SETTINGS_STORE={}))[pluginName]||(t[pluginName]={}),window.MILLENNIUM_SIDEBAR_NAVIGATION_PANELS||(window.MILLENNIUM_SIDEBAR_NAVIGATION_PANELS={}),function(e){e[e.CallServerMethod=0]="CallServerMethod"}(o||(o={}));let l=window.MILLENNIUM_PLUGIN_SETTINGS_STORE[pluginName],n=`Millennium.Internal.IPC.[${pluginName}]`;const i={DropDown:["string","number","boolean"],NumberTextInput:["number"],StringTextInput:["string"],FloatTextInput:["number"],CheckBox:["boolean"],NumberSlider:["number"],FloatSlider:["number"]};function a(e,t,l){return MILLENNIUM_BACKEND_IPC.postMessage(o.CallServerMethod,{pluginName:e,methodName:"__builtins__.__update_settings_value__",argumentList:{name:t,value:l}})}l.ignoreProxyFlag=!1,async function(){for(;"undefined"==typeof MainWindowBrowserManager;)await new Promise(e=>setTimeout(e,0));MainWindowBrowserManager?.m_browser?.on("message",(e,t)=>{if(e!==n)return;const{name:o,value:i}=JSON.parse(t);l.ignoreProxyFlag=!0,l.settingsStore[o]=i,a(pluginName,o,i),l.ignoreProxyFlag=!1})}();const c=e=>new Proxy(e,{set(e,t,o){if(!(t in e))throw new TypeError(`Property ${String(t)} does not exist on plugin settings`);const c=i[e[t].type],r=e[t]?.range;if(c.includes("number")&&"number"==typeof o&&(r&&(o=function(e,t,o){return Math.max(t,Math.min(o,e))}(o,r[0],r[1])),o||(o=0)),!c.includes(typeof o))throw new TypeError(`Expected ${c.join(" or ")}, got ${typeof o}`);return e[t].value=o,((e,t)=>{l.ignoreProxyFlag||(a(pluginName,e,t),"undefined"!=typeof MainWindowBrowserManager&&MainWindowBrowserManager?.m_browser?.PostMessage(n,JSON.stringify({name:e,value:t})))})(String(t),o),!0},get:(e,t)=>"__raw_get_internals__"===t?e:t in e?e[t].value:void 0});l.DefinePluginSetting=c,l.settingsStore=c({})}InitializePlugins();const __call_server_method__=(e,t)=>Millennium.callServerMethod(pluginName,e,t),__wrapped_callable__=e=>MILLENNIUM_API.callable(__call_server_method__,e);let PluginEntryPointMain=function(){return function(e,t,o,l){"use strict";const n=__wrapped_callable__("Backend.get_coll_image"),i=__wrapped_callable__("Backend.set_coll_image"),a=__wrapped_callable__("Backend.get_folder_image"),c=__wrapped_callable__("Backend.set_folder_image"),r=__wrapped_callable__("Backend.get_last_filter"),s=__wrapped_callable__("Backend.set_last_filter");__wrapped_callable__("Backend.get_folder");const d=__wrapped_callable__("Backend.set_folder"),p=__wrapped_callable__("Backend.get_folder_list"),u=__wrapped_callable__("Backend.get_folder_map"),m=__wrapped_callable__("Backend.add_folder"),g=__wrapped_callable__("Backend.remove_folder"),_=async(e,o=document)=>[...await t.Millennium.findElement(o,e)][0];async function S(e){if("SP Desktop_uid0"===e.m_strName){for(var S=void 0;!S;){console.log("[steam-collections-plus] Waiting for MainWindowBrowserManager");try{S=MainWindowBrowserManager}catch{await t.sleep(100)}}MainWindowBrowserManager.m_browser.on("finished-request",async(S,f)=>{if("/library/collections"===MainWindowBrowserManager.m_lastLocation.pathname){const o=JSON.parse(await p({})),r=JSON.parse(await u({})),s=await _(`div.${t.findModule(e=>e.CSSGrid).CSSGrid}`,e.m_popup.document);if(s){var w="root";const p=async e=>{const t=s.querySelectorAll(":scope > div[data-itempath]");for(let o=0;o<t.length;o++)t[o].dataset.itempath===e?t[o].style.display="":t[o].style.display="none";const o=s.parentElement.parentElement.parentElement.parentElement.querySelector("div.steam-collections-plus-path"),l=": "+e.replaceAll("/"," â‰« ");o.textContent=l,w=e};if(o.length>0){const e=s.querySelectorAll(":scope > div[role='row']");for(let t=0;t<e.length;t++)e[t].style.display="none"}const _=async()=>{const e=s.querySelectorAll(`:scope > div > div > div:not(.${t.findModule(e=>e.NewCollection).NewCollection})`);for(let l=0;l<e.length;l++){const i=e[l].querySelector(`div.${t.findModule(e=>e.CollectionLabel).CollectionLabel} > div:not(.${t.findModule(e=>e.CollectionLabelCount).CollectionLabelCount})`).textContent;console.log("[steam-collections-plus] Processing collection",i);var o="type-music";const a=collectionStore.GetUserCollectionsByName(i);a.length>0&&(o=a[0].m_strId);const c=await n({coll_id:o});if(""!==c){e[l].querySelector(`div.${t.findModule(e=>e.DisplayCaseContainerBounds).DisplayCaseContainerBounds}`).style.display="none",e[l].querySelector(`div.${t.findModule(e=>e.CollectionImage).CollectionImage}`).style.backgroundImage=`url(${c})`,e[l].querySelector(`div.${t.findModule(e=>e.CollectionImage).CollectionImage}`).style.backgroundSize="cover",e[l].querySelector(`div.${t.findModule(e=>e.CollectionImage).CollectionImage}`).style.backgroundPosition="center";const o=e[l].querySelector(`div.${t.findModule(e=>e.BackgroundImage).BackgroundImage}`);o&&o.remove()}e[l].dataset.collectionid=o,e[l].dataset.itempath=o in r?r[o]:"root"}},S=async(o,l,a,c)=>{console.log("[steam-collections-plus] Processing collection",a);const d=o.cloneNode(!0);d.querySelector(`div.${t.findModule(e=>e.CollectionLabel).CollectionLabel} > div:not(.Focusable)`).textContent=a,d.querySelector(`div.${t.findModule(e=>e.CollectionLabel).CollectionLabel} > div.Focusable > div`).textContent=c;const p=await n({coll_id:l});""!==p&&(d.querySelector(`div.${t.findModule(e=>e.CollectionImage).CollectionImage}`).style.backgroundImage=`url(${p})`,d.querySelector(`div.${t.findModule(e=>e.CollectionImage).CollectionImage}`).style.backgroundSize="cover",d.querySelector(`div.${t.findModule(e=>e.CollectionImage).CollectionImage}`).style.backgroundPosition="center"),d.dataset.collectionid=l,d.dataset.itempath=l in r?r[l]:"root",s.appendChild(d),d.addEventListener("click",async()=>{SteamUIStore.Navigate(`/library/collection/${l}`)}),d.addEventListener("contextmenu",async()=>{t.showContextMenu(window.SP_REACT.createElement(t.Menu,{label:"Collections+ Collection Options"},window.SP_REACT.createElement(t.MenuItem,{onClick:async()=>{await collectionStore.DeleteCollection(l),d.remove(),console.log("[steam-collections-plus] Deleted collection",l)}}," Delete collection "),window.SP_REACT.createElement(t.MenuItem,{onClick:async()=>{const o=e.m_popup.document.createElement("input");o.type="file",o.style.display="none",o.addEventListener("change",e=>{if(e.target.files){console.log(e.target.files[0]);const o=e.target.files[0];if(o){const e=new FileReader;e.onload=async o=>{const n=e.result;await i({coll_id:l,image_data:n}),d.querySelector(`div.${t.findModule(e=>e.CollectionImage).CollectionImage}`).style.backgroundImage=`url(${n})`,d.querySelector(`div.${t.findModule(e=>e.CollectionImage).CollectionImage}`).style.backgroundSize="cover",d.querySelector(`div.${t.findModule(e=>e.CollectionImage).CollectionImage}`).style.backgroundPosition="center",console.log("[steam-collections-plus] Image set for",l)},e.readAsDataURL(o)}}o.remove()}),d.appendChild(o),o.click()}}," Set collection image "),window.SP_REACT.createElement(t.MenuItem,{onClick:async()=>{await i({coll_id:l,image_data:""}),d.querySelector(`div.${t.findModule(e=>e.CollectionImage).CollectionImage}`).style.backgroundImage="",console.log("[steam-collections-plus] Image reset for",l)}}," Reset collection image ")),d,{bForcePopup:!0})})};if(o.length>0){const e=s.querySelector(`:scope > div > div > div:not(.${t.findModule(e=>e.NewCollection).NewCollection})`).cloneNode(!0),o=e.querySelector(`div.${t.findModule(e=>e.BackgroundImage).BackgroundImage}`);o&&o.remove();const l=e.querySelector(`div.${t.findModule(e=>e.DisplayCaseContainerBounds).DisplayCaseContainerBounds}`);l&&l.remove();for(let t=0;t<collectionStore.userCollections.length;t++){const o=collectionStore.userCollections[t].m_strId,l=collectionStore.userCollections[t].m_strName,n=collectionStore.userCollections[t].allApps.length;await S(e,o,l,n)}}else await _();const f=async(o,l)=>{const n=l.substring(0,l.lastIndexOf("/")),i=l.substring(l.lastIndexOf("/")+1),r=o.cloneNode(!0);r.querySelector(`div.${t.findModule(e=>e.BigPlus).BigPlus}`).innerHTML="ðŸ“",r.querySelector(`div.${t.findModule(e=>e.CollectionLabel).CollectionLabel}`).textContent=i,r.dataset.itempath=n,s.insertBefore(r,o.nextSibling);const d=await a({folder_path:l});""!==d&&(r.style.backgroundImage=`url(${d})`,r.style.backgroundSize="cover",r.style.backgroundPosition="center"),r.addEventListener("click",async()=>{p(l)}),r.addEventListener("contextmenu",async()=>{t.showContextMenu(window.SP_REACT.createElement(t.Menu,{label:"Collections+ Folder Options"},window.SP_REACT.createElement(t.MenuItem,{onClick:async()=>{await g({folder_path:l}),r.remove();const e=s.querySelectorAll(`:scope > div.${t.findModule(e=>e.NewCollection).NewCollection}`);for(let t=0;t<e.length;t++)e[t].dataset.itempath.startsWith(`${l}/`)&&e[t].remove();const o=s.querySelectorAll(`:scope > div:not(.${t.findModule(e=>e.NewCollection).NewCollection})`);for(let e=0;e<o.length;e++)(o[e].dataset.itempath===l||o[e].dataset.itempath.startsWith(`${l}/`))&&(o[e].dataset.itempath="root");p(w)}}," Delete folder "),window.SP_REACT.createElement(t.MenuItem,{onClick:async()=>{const t=e.m_popup.document.createElement("input");t.type="file",t.style.display="none",t.addEventListener("change",e=>{if(e.target.files){console.log(e.target.files[0]);const t=e.target.files[0];if(t){const e=new FileReader;e.onload=async t=>{const o=e.result;await c({folder_path:l,image_data:o}),r.style.backgroundImage=`url(${o})`,r.style.backgroundSize="cover",r.style.backgroundPosition="center",console.log("[steam-collections-plus] Image set for",l)},e.readAsDataURL(t)}}t.remove()}),r.appendChild(t),t.click()}}," Set folder image "),window.SP_REACT.createElement(t.MenuItem,{onClick:async()=>{await c({folder_path:l,image_data:""}),r.style.backgroundImage="",console.log("[steam-collections-plus] Image reset for",l)}}," Reset folder image ")),r.querySelector(`div.${t.findModule(e=>e.BigPlus).BigPlus}`),{bForcePopup:!0})})},C=s.querySelector(`:scope > div > div > div.${t.findModule(e=>e.NewCollection).NewCollection}`);C.dataset.itempath="root";for(let e=0;e<o.length;e++){const t=o[e];f(C,t)}if(!s.querySelector("div.steam-collections-plus-path")){const o=s.parentElement.parentElement.parentElement.parentElement.firstChild.firstChild,n=o.cloneNode(!0);n.classList.add("steam-collections-plus-path"),n.textContent=": root",o.parentElement.insertBefore(n,o.nextSibling);const i=o.cloneNode(!0);i.textContent="[UP]",o.parentElement.insertBefore(i,o),i.addEventListener("click",async()=>{if("root"!==w){const e=w.substring(0,w.lastIndexOf("/"));p(e)}});const a=o.cloneNode(!0);a.textContent="[C+]",o.parentElement.insertBefore(a,o),a.addEventListener("click",async()=>{t.showModal(window.SP_REACT.createElement(e=>{const[o,n]=l.useState("root"),[i,a]=l.useState([]);return l.useEffect(()=>{(async()=>{n(w.substring(w.lastIndexOf("/")+1));let e=[];const t=JSON.parse(await u({}));for(let o=0;o<collectionStore.userCollections.length;o++){const l=collectionStore.userCollections[o].m_strId;if("uncategorized"!==l){const n=collectionStore.userCollections[o].m_strName;let i="root";l in t&&(i=t[l]),e.push({collectionID:l,collectionName:n,collectionFolder:i})}}a(e)})()},[]),window.SP_REACT.createElement(t.ModalRoot,{closeModal:()=>{}},window.SP_REACT.createElement("span",{style:{textTransform:"uppercase"}},window.SP_REACT.createElement("b",null,o))," ",window.SP_REACT.createElement("br",null),window.SP_REACT.createElement("br",null),"Create subfolder (EXPERIMENTAL): ",window.SP_REACT.createElement("br",null),window.SP_REACT.createElement(t.TextField,{id:"newFolderName",placeholder:"Folder"}),window.SP_REACT.createElement(t.DialogButton,{style:{width:"120px"},onClick:async e=>{const t=w+"/"+e.target.parentElement.querySelector("#newFolderName").value;await m({folder_path:t})&&(f(C,t),p(w))}},"Add"),window.SP_REACT.createElement("hr",null),"Add collections: ",window.SP_REACT.createElement("br",null),i.map((e,t)=>window.SP_REACT.createElement("div",null,window.SP_REACT.createElement("input",{key:t,id:`coll-chkbox-${t}`,"data-collectionid":e.collectionID,"data-incurrentfolder":e.collectionFolder===w,type:"checkbox",defaultChecked:e.collectionFolder===w}),window.SP_REACT.createElement("label",{for:`coll-chkbox-${t}`},e.collectionName," (Currently in ",e.collectionFolder,")"))),window.SP_REACT.createElement(t.DialogButton,{style:{width:"120px"},onClick:async e=>{console.log("[steam-collections-plus] Applying selection...");const t=e.target.parentElement.querySelectorAll("input[type=checkbox]");for(let e=0;e<t.length;e++){const o=t[e].dataset.collectionid;t[e].checked||"true"!==t[e].dataset.incurrentfolder?t[e].checked&&"false"===t[e].dataset.incurrentfolder&&(console.log(`[steam-collections-plus] Moving ${o} to`,w),await d({coll_id:o,folder_path:w}),s.querySelector(`:scope > div[data-collectionid="${o}"]`).dataset.itempath=w):(console.log(`[steam-collections-plus] Removing ${o} from`,w),await d({coll_id:o,folder_path:"root"}),s.querySelector(`:scope > div[data-collectionid="${o}"]`).dataset.itempath="root")}p(w)}},"Apply"))},{key:w}),e.m_popup.window,{strTitle:"Folder Management",bHideMainWindowForPopouts:!1,bForcePopOut:!0,popupHeight:700,popupWidth:400})})}new MutationObserver(async(e,t)=>{if(o.length>0)for(const t of e)for(const e of t.addedNodes)"row"===e.role&&(e.style.display="none");else await _(),p(w)}).observe(s,{childList:!0}),p("root")}}else if(MainWindowBrowserManager.m_lastLocation.pathname.startsWith("/library/collection/")){const l=await _(`div.${t.findModule(e=>e.CollectionOptions).CollectionOptions}`,e.m_popup.document);if(!l.querySelector("button.collectionsplus-button")){const n=e.m_popup.document.createElement("div");o.createRoot(n).render(window.SP_REACT.createElement(t.DialogButton,{className:"collectionsplus-button",style:{width:"40px",marginLeft:"3px",marginRight:"3px"}},"C+")),l.insertBefore(n,l.firstChild.nextSibling),n.addEventListener("click",async()=>{async function a(i,a){const c=e.m_popup.document.createElement("div");o.createRoot(c).render(window.SP_REACT.createElement(t.TextField,{placeholder:"filter"})),l.insertBefore(c,n.nextSibling);const d=e.m_popup.document.createElement("div");o.createRoot(d).render(window.SP_REACT.createElement(t.DialogButton,{style:{width:"40px"}},"OK")),l.insertBefore(d,c.nextSibling),c.querySelector("input").value=a?await r({coll_id:uiStore.currentGameListSelection.strCollectionId,op_type:"filter"}):i?await r({coll_id:uiStore.currentGameListSelection.strCollectionId,op_type:"add"}):await r({coll_id:uiStore.currentGameListSelection.strCollectionId,op_type:"remove"}),d.addEventListener("click",async()=>{const e=c.querySelector("input").value;console.log("[steam-collections-plus] Applying",e),d.firstChild.innerHTML="Working...";var t,o=void 0;if(t=a?collectionStore.GetCollection(uiStore.currentGameListSelection.strCollectionId).allApps:i?collectionStore.allAppsCollection.allApps:collectionStore.GetCollection(uiStore.currentGameListSelection.strCollectionId).allApps,a){1===collectionStore.GetUserCollectionsByName("filtered").length&&collectionStore.GetUserCollectionsByName("filtered")[0].Delete();const e=collectionStore.NewUnsavedCollection("filtered",void 0,[]);await e.Save(),o=e.m_strId}else o=uiStore.currentGameListSelection.strCollectionId;const l=e.split(";");for(let e=0;e<t.length;e++){const a=t[e];d.firstChild.innerHTML=`Working... (${e}/${t.length})`;var n=!0;for(let e=0;e<l.length;e++){const t=l[e].split(" "),o=[t[0],t[1],t.slice(2).join(" ")],i=o[0],c=o[1];if("collection"===i){const e=collectionStore.GetUserCollectionsByName(o[2])[0];if("="===c){if(-1===e.allApps.findIndex(e=>e.appid===a.appid)){n=!1;break}}else if("!="===c){if(e.allApps.findIndex(e=>e.appid===a.appid)>-1){n=!1;break}}else console.log("[steam-collections-plus] Invalid operator")}else if("category"===i){const e=o[2];if("="===c){if(!a.m_setStoreCategories.has(Number(e))){n=!1;break}}else if("!="===c){if(a.m_setStoreCategories.has(Number(e))){n=!1;break}}else console.log("[steam-collections-plus] Invalid operator")}else if("tag"===i){const e=o[2];if("="===c){if(!a.m_setStoreTags.has(Number(e))){n=!1;break}}else if("!="===c){if(a.m_setStoreTags.has(Number(e))){n=!1;break}}else console.log("[steam-collections-plus] Invalid operator")}else{const e=a[i],t=typeof e;if("boolean"===t)if("true"===c){if(!e){n=!1;break}}else if("false"===c){if(e){n=!1;break}}else console.log("[steam-collections-plus] Invalid operator");else if("string"===t){const t=o[2];if("="===c){if(e!==t){n=!1;break}}else if("!="===c){if(e===t){n=!1;break}}else if("begins"===c){if(!e.startsWith(t)){n=!1;break}}else console.log("[steam-collections-plus] Invalid operator")}else if("number"===t){const t=Number(o[2]);if("="===c){if(e!==t){n=!1;break}}else if("!="===c){if(e===t){n=!1;break}}else if("<"===c){if(e>=t){n=!1;break}}else if(">"===c){if(e<=t){n=!1;break}}else if("<="===c){if(e>t){n=!1;break}}else if(">="===c){if(e<t){n=!1;break}}else console.log("[steam-collections-plus] Invalid operator")}else console.log("[steam-collections-plus] Unsupported left object type")}}n&&(console.log("[steam-collections-plus] Found",a.display_name),collectionStore.AddOrRemoveApp([a.appid],i,o))}d.remove(),c.remove(),a?(await s({coll_id:uiStore.currentGameListSelection.strCollectionId,op_type:"filter",op_data:e}),SteamUIStore.Navigate(`/library/collection/${o}`),console.log("[steam-collections-plus] Applications filtered in",uiStore.currentGameListSelection.strCollectionId)):i?(await s({coll_id:uiStore.currentGameListSelection.strCollectionId,op_type:"add",op_data:e}),console.log("[steam-collections-plus] Applications added to",uiStore.currentGameListSelection.strCollectionId)):(await s({coll_id:uiStore.currentGameListSelection.strCollectionId,op_type:"remove",op_data:e}),console.log("[steam-collections-plus] Applications removed from",uiStore.currentGameListSelection.strCollectionId))})}t.showContextMenu(window.SP_REACT.createElement(t.Menu,{label:"Collections+ Options"},window.SP_REACT.createElement(t.MenuItem,{onClick:async()=>{a(!0,!1)}}," Add applications in bulk "),window.SP_REACT.createElement(t.MenuItem,{onClick:async()=>{a(!1,!1)}}," Remove applications in bulk "),window.SP_REACT.createElement(t.MenuItem,{onClick:async()=>{a(!0,!0)}}," Filter applications "),window.SP_REACT.createElement(t.MenuItem,{onClick:async()=>{const t=e.m_popup.document.createElement("input");t.type="file",t.style.display="none",t.addEventListener("change",e=>{if(e.target.files){console.log(e.target.files[0]);const t=e.target.files[0];if(t){const e=new FileReader;e.onload=async t=>{const o=e.result;await i({coll_id:uiStore.currentGameListSelection.strCollectionId,image_data:o}),console.log("[steam-collections-plus] Image set for",uiStore.currentGameListSelection.strCollectionId)},e.readAsDataURL(t)}}t.remove()}),l.appendChild(t),t.click()}}," Set collection image "),window.SP_REACT.createElement(t.MenuItem,{onClick:async()=>{await i({coll_id:uiStore.currentGameListSelection.strCollectionId,image_data:""}),console.log("[steam-collections-plus] Image reset for",uiStore.currentGameListSelection.strCollectionId)}}," Reset collection image "),window.SP_REACT.createElement(t.MenuItem,{onClick:async()=>{const e=collectionStore.GetCollection(uiStore.currentGameListSelection.strCollectionId).allApps;if(e.length>0){const t=Math.floor(Math.random()*e.length);SteamClient.Apps.RunGame(e[t].appid.toString(),"",0,0)}}}," Start random application "),window.SP_REACT.createElement(t.MenuItem,{onClick:async()=>{const e=collectionStore.GetCollection(uiStore.currentGameListSelection.strCollectionId).allApps.filter(e=>e.installed);if(e.length>0){const t=Math.floor(Math.random()*e.length);SteamClient.Apps.RunGame(e[t].appid.toString(),"",0,0)}}}," Start random application (installed only) "),window.SP_REACT.createElement(t.MenuItem,{onClick:async()=>{const e=collectionStore.GetCollection(uiStore.currentGameListSelection.strCollectionId).allApps;if(e.length>0){const t=Math.floor(Math.random()*e.length);SteamUIStore.Navigate(`/library/app/${e[t].appid.toString()}`)}}}," Show random application "),window.SP_REACT.createElement(t.MenuItem,{onClick:async()=>{const e=collectionStore.GetCollection(uiStore.currentGameListSelection.strCollectionId).allApps.filter(e=>e.installed);if(e.length>0){const t=Math.floor(Math.random()*e.length);SteamUIStore.Navigate(`/library/app/${e[t].appid.toString()}`)}}}," Show random application (installed only) ")),n,{bForcePopup:!0})})}}else if(MainWindowBrowserManager.m_lastLocation.pathname.startsWith("/library/app/")){const o=await _(`div.${t.findModule(e=>e.InPage).InPage} div.${t.findModule(e=>e.AppButtonsContainer).AppButtonsContainer} > div.${t.findModule(e=>e.MenuButtonContainer).MenuButtonContainer}:not([role="button"])`,e.m_popup.document);if(!o.parentNode.querySelector("div.coll-plus-app-button")){const n=o.cloneNode(!0);n.classList.add("coll-plus-app-button"),n.firstChild.innerHTML="C+",o.parentNode.insertBefore(n,o.nextSibling),n.addEventListener("click",async()=>{t.showModal(window.SP_REACT.createElement(e=>{const o={display:"block",position:"relative",paddingLeft:"calc(2 * var(--spacing) - var(--radius) - 2px)"},n={marginLeft:"calc(var(--radius) - var(--spacing))",paddingLeft:"0"},[i,a]=l.useState(""),[c,r]=l.useState([]),[s,d]=l.useState([]),m=e=>window.SP_REACT.createElement("li",{style:o},window.SP_REACT.createElement("details",{open:!0},window.SP_REACT.createElement("summary",null,e.replaceAll("/"," â‰« ")),window.SP_REACT.createElement("ul",{style:n},s.filter(t=>t.collectionFolder===e).map((e,t)=>window.SP_REACT.createElement("li",{style:o},window.SP_REACT.createElement("input",{key:e.collectionID,id:`coll-chkbox-${e.collectionID}`,"data-collectionid":e.collectionID,"data-incollection":e.appInColl,type:"checkbox",defaultChecked:e.appInColl}),window.SP_REACT.createElement("label",{for:`coll-chkbox-${e.collectionID}`},e.collectionName))),c.filter(t=>t.startsWith(`${e}/`)).filter(t=>!t.includes("/",e.length+1)).map((e,t)=>m(e)))));return l.useEffect(()=>{(async()=>{const e=appStore.allApps.find(e=>e.appid===uiStore.currentGameListSelection.nAppId);a(e.display_name),r(["root"].concat(JSON.parse(await p({}))));let t=[];const o=JSON.parse(await u({}));for(let e=0;e<collectionStore.userCollections.length;e++){const l=collectionStore.userCollections[e].m_strId;if("uncategorized"!==l){const n=collectionStore.userCollections[e].m_strName;let i="root";l in o&&(i=o[l]);let a=!1;collectionStore.userCollections[e].allApps.find(e=>e.appid===uiStore.currentGameListSelection.nAppId)&&(a=!0),t.push({collectionID:l,collectionName:n,collectionFolder:i,appInColl:a})}}d(t)})()},[]),window.SP_REACT.createElement(t.ModalRoot,{closeModal:()=>{}},window.SP_REACT.createElement("span",{style:{textTransform:"uppercase"}},window.SP_REACT.createElement("b",null,i))," ",window.SP_REACT.createElement("br",null),window.SP_REACT.createElement("br",null),"Collections: ",window.SP_REACT.createElement("br",null),window.SP_REACT.createElement("ul",{style:{"--spacing":"1.5rem","--radius":"10px"}},m("root")),window.SP_REACT.createElement(t.DialogButton,{style:{width:"120px"},onClick:async e=>{console.log("[steam-collections-plus] Applying selection...");const t=e.target.parentElement.querySelectorAll("input[type=checkbox]");for(let e=0;e<t.length;e++){const o=t[e].dataset.collectionid;t[e].checked||"true"!==t[e].dataset.incollection?t[e].checked&&"false"===t[e].dataset.incollection&&(console.log("[steam-collections-plus] Adding app to",o),collectionStore.AddOrRemoveApp([uiStore.currentGameListSelection.nAppId],!0,o),t[e].dataset.incollection="true"):(console.log("[steam-collections-plus] Removing app from",o),collectionStore.AddOrRemoveApp([uiStore.currentGameListSelection.nAppId],!1,o),t[e].dataset.incollection="false")}}},"Apply"))},{key:uiStore.currentGameListSelection.nAppId}),e.m_popup.window,{strTitle:"Collections",bHideMainWindowForPopouts:!1,bForcePopOut:!0,popupHeight:700,popupWidth:500})})}}})}}return e.default=async function(){for(console.log("[steam-collections-plus] Frontend startup"),await App.WaitForServicesInitialized();"undefined"==typeof g_PopupManager||"undefined"==typeof MainWindowBrowserManager;)await t.sleep(100);const e=g_PopupManager.GetExistingPopup("SP Desktop_uid0");e&&S(e),g_PopupManager.AddPopupCreatedCallback(S)},Object.defineProperty(e,"__esModule",{value:!0}),e}({},window.MILLENNIUM_API,window.SP_REACTDOM,window.SP_REACT)};function ExecutePluginModule(){let e=window.MILLENNIUM_PLUGIN_SETTINGS_STORE[pluginName];e.OnPluginConfigChange=function(t,o,l){t in e.settingsStore&&(e.ignoreProxyFlag=!0,e.settingsStore[t]=l,e.ignoreProxyFlag=!1)},MILLENNIUM_BACKEND_IPC.postMessage(0,{pluginName:pluginName,methodName:"__builtins__.__millennium_plugin_settings_parser__"}).then(async t=>{"string"==typeof t.returnValue&&(e.ignoreProxyFlag=!0,e.settingsStore=e.DefinePluginSetting(Object.fromEntries(JSON.parse(atob(t.returnValue)).map(e=>[e.functionName,e]))),e.ignoreProxyFlag=!1);let o=PluginEntryPointMain();Object.assign(window.PLUGIN_LIST[pluginName],{...o,__millennium_internal_plugin_name_do_not_use_or_change__:pluginName});let l=await o.default();var n;l&&(n=l)&&void 0!==n.title&&void 0!==n.icon&&void 0!==n.content?(window.MILLENNIUM_SIDEBAR_NAVIGATION_PANELS[pluginName]=l,MILLENNIUM_BACKEND_IPC.postMessage(1,{pluginName:pluginName})):console.warn(`Plugin ${pluginName} does not contain proper SidebarNavigation props and therefor can't be mounted by Millennium. Please ensure it has a title, icon, and content.`)})}ExecutePluginModule();