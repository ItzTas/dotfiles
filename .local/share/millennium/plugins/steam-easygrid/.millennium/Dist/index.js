const MILLENNIUM_IS_CLIENT_MODULE=!0,pluginName="steam-easygrid";function InitializePlugins(){var e,t;let n;(e=window.PLUGIN_LIST||(window.PLUGIN_LIST={}))[pluginName]||(e[pluginName]={}),(t=window.MILLENNIUM_PLUGIN_SETTINGS_STORE||(window.MILLENNIUM_PLUGIN_SETTINGS_STORE={}))[pluginName]||(t[pluginName]={}),window.MILLENNIUM_SIDEBAR_NAVIGATION_PANELS||(window.MILLENNIUM_SIDEBAR_NAVIGATION_PANELS={}),function(e){e[e.CallServerMethod=0]="CallServerMethod"}(n||(n={}));let i=window.MILLENNIUM_PLUGIN_SETTINGS_STORE[pluginName],a=`Millennium.Internal.IPC.[${pluginName}]`;const o={DropDown:["string","number","boolean"],NumberTextInput:["number"],StringTextInput:["string"],FloatTextInput:["number"],CheckBox:["boolean"],NumberSlider:["number"],FloatSlider:["number"]};function r(e,t,i){return MILLENNIUM_BACKEND_IPC.postMessage(n.CallServerMethod,{pluginName:e,methodName:"__builtins__.__update_settings_value__",argumentList:{name:t,value:i}})}i.ignoreProxyFlag=!1,async function(){for(;"undefined"==typeof MainWindowBrowserManager;)await new Promise(e=>setTimeout(e,0));MainWindowBrowserManager?.m_browser?.on("message",(e,t)=>{if(e!==a)return;const{name:n,value:o}=JSON.parse(t);i.ignoreProxyFlag=!0,i.settingsStore[n]=o,r(pluginName,n,o),i.ignoreProxyFlag=!1})}();const l=e=>new Proxy(e,{set(e,t,n){if(!(t in e))throw new TypeError(`Property ${String(t)} does not exist on plugin settings`);const l=o[e[t].type],p=e[t]?.range;if(l.includes("number")&&"number"==typeof n&&(p&&(n=function(e,t,n){return Math.max(t,Math.min(n,e))}(n,p[0],p[1])),n||(n=0)),!l.includes(typeof n))throw new TypeError(`Expected ${l.join(" or ")}, got ${typeof n}`);return e[t].value=n,((e,t)=>{i.ignoreProxyFlag||(r(pluginName,e,t),"undefined"!=typeof MainWindowBrowserManager&&MainWindowBrowserManager?.m_browser?.PostMessage(a,JSON.stringify({name:e,value:t})))})(String(t),n),!0},get:(e,t)=>"__raw_get_internals__"===t?e:t in e?e[t].value:void 0});i.DefinePluginSetting=l,i.settingsStore=l({})}InitializePlugins();const __call_server_method__=(e,t)=>Millennium.callServerMethod(pluginName,e,t),__wrapped_callable__=e=>MILLENNIUM_API.callable(__call_server_method__,e);let PluginEntryPointMain=function(){return function(e,t,n,i){"use strict";const a=__wrapped_callable__("Backend.get_image"),o=__wrapped_callable__("Backend.get_current_index"),r=__wrapped_callable__("Backend.get_max_index"),l=__wrapped_callable__("Backend.get_steamgriddb_id"),p=__wrapped_callable__("Backend.purge_cache"),s=__wrapped_callable__("Backend.get_thumb_list"),d=__wrapped_callable__("Backend.get_width_mult"),c=__wrapped_callable__("Backend.get_expand_headers_value"),_=__wrapped_callable__("Backend.get_app_page_button"),u=__wrapped_callable__("Backend.get_stagger_main_load"),m=__wrapped_callable__("Backend.get_stagger_page_load"),g=async(e,n=document)=>[...await t.Millennium.findElement(n,e)][0];function w(e){return n=>{const d={width:e.m_popup.window.screen.width*n.imageWidthMult+"px",minWidth:"150px",height:"auto"},c={width:"100%",height:"auto",objectFit:"cover",borderRadius:"8px"},[_,u]=i.useState(-1),[m,g]=i.useState(-1),[w,y]=i.useState([]),S=async()=>{await a({app_name:n.appname,app_id:n.appid,image_type:n.imagetype,image_num:-1,set_current:!1}),u(await o({app_id:n.appid,image_type:n.imagetype})),g(await r({app_id:n.appid,image_type:n.imagetype})),y(JSON.parse(await s({app_id:n.appid,image_type:n.imagetype})))},M=async e=>{const t=Number(e.target.dataset.imageindex);console.log("[steam-easygrid 3] Setting image to:",t);const i=await a({app_name:n.appname,app_id:n.appid,image_type:n.imagetype,image_num:t,set_current:!0});if(""!==i){const e=i.split(";",2);SteamClient.Apps.SetCustomArtworkForApp(n.appid,e[1],e[0],n.imagetype),u(t)}};return i.useEffect(()=>{S()},[]),window.SP_REACT.createElement("div",null,"App ID: ",n.appid," / App Name: ",n.appname," / Image Type: ",n.imagetype," ",window.SP_REACT.createElement("br",null),"Current: ",_," / Max: ",m," ",window.SP_REACT.createElement("br",null),window.SP_REACT.createElement(t.DialogButton,{style:{width:"120px",display:"inline-block"},onClick:async e=>{console.log("[steam-easygrid 3] Resetting image..."),SteamClient.Apps.ClearCustomArtworkForApp(n.appid,n.imagetype),await a({app_name:n.appname,app_id:n.appid,image_type:n.imagetype,image_num:-1,set_current:!0}),u(-1)}},"Reset"),"  ",window.SP_REACT.createElement(t.DialogButton,{style:{width:"120px",display:"inline-block"},onClick:async()=>{console.log("[steam-easygrid 3] Purging cache and reloading..."),await p({app_id:n.appid}),S()}},"Purge Cache"),"  ",window.SP_REACT.createElement(t.DialogButton,{style:{width:"120px",display:"inline-block"},onClick:async()=>{console.log("[steam-easygrid 3] Opening SGDB Webpage...");const e=await async function(e){try{return await l({app_id:e})}catch(e){return void console.error("[steam-easygrid 3] Failed to get SteamGridDB ID:",e)}}(n.appid);window.open(`https://www.steamgriddb.com/game/${e}`,"_blank")}},"Open Webpage"),window.SP_REACT.createElement("br",null),window.SP_REACT.createElement("div",{style:{display:"flex",flexWrap:"wrap",overflowX:"hidden",overflowY:"auto",padding:"10px",gap:"10px",width:"100%"}},w.map((e,t)=>"static"===e[1]?window.SP_REACT.createElement("div",{style:d},window.SP_REACT.createElement("img",{key:t,"data-imageindex":t,src:e[0],alt:e[1],style:c,onClick:M})):window.SP_REACT.createElement("div",{style:d},window.SP_REACT.createElement("video",{key:t,"data-imageindex":t,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,src:e[0],alt:e[1],style:c,onClick:M})))))}}async function y(e){const n=w(e),i=collectionStore.GetCollection(uiStore.currentGameListSelection.strCollectionId).allApps.find(e=>e.appid===uiStore.currentGameListSelection.nAppId),a=await d({app_id:uiStore.currentGameListSelection.nAppId,image_type:1})/100,o=await d({app_id:uiStore.currentGameListSelection.nAppId,image_type:2})/100,r=await d({app_id:uiStore.currentGameListSelection.nAppId,image_type:0})/100;await d({app_id:uiStore.currentGameListSelection.nAppId,image_type:4}),t.showModal(window.SP_REACT.createElement(t.SidebarNavigation,{pages:[{title:window.SP_REACT.createElement("div",null,"Hero"),content:window.SP_REACT.createElement(n,{key:"hero_page",appid:uiStore.currentGameListSelection.nAppId,appname:i.display_name,imagetype:1,imageWidthMult:a})},{title:window.SP_REACT.createElement("div",null,"Logo"),content:window.SP_REACT.createElement(n,{key:"logo_page",appid:uiStore.currentGameListSelection.nAppId,appname:i.display_name,imagetype:2,imageWidthMult:o})},{title:window.SP_REACT.createElement("div",null,"Grid"),content:window.SP_REACT.createElement(n,{key:"grid_page",appid:uiStore.currentGameListSelection.nAppId,appname:i.display_name,imagetype:0,imageWidthMult:r})},{title:window.SP_REACT.createElement("div",null,"Wide Grid"),content:window.SP_REACT.createElement(n,{key:"widegrid_page",appid:uiStore.currentGameListSelection.nAppId,appname:i.display_name,imagetype:3,imageWidthMult:r})}],showTitle:!0,title:i.display_name}),e.m_popup.window,{strTitle:"EasyGrid",bHideMainWindowForPopouts:!1,bForcePopOut:!0,popupHeight:700,popupWidth:1500})}async function S(e){const n=await g(`div.${t.findModule(e=>e.TopCapsule).TopCapsule}`,e.m_popup.document);if(n.classList.contains("easygrid-header")||(n.addEventListener("dblclick",async()=>{y(e)}),n.classList.add("easygrid-header")),await _({})){const n=await g(`div.${t.findModule(e=>e.InPage).InPage} div.${t.findModule(e=>e.AppButtonsContainer).AppButtonsContainer} > div.${t.findModule(e=>e.MenuButtonContainer).MenuButtonContainer}:not([role="button"])`,e.m_popup.document);if(!n.parentNode.querySelector("div.easygrid-button")){const i=n.cloneNode(!0);i.classList.add("easygrid-button"),i.firstChild.innerHTML="SG",n.parentNode.insertBefore(i,n.nextSibling),i.addEventListener("click",async()=>{t.showContextMenu(window.SP_REACT.createElement(t.Menu,{label:"SGDB Options"},window.SP_REACT.createElement(t.MenuItem,{onClick:async()=>{const e=collectionStore.GetCollection(uiStore.currentGameListSelection.strCollectionId).allApps.find(e=>e.appid===uiStore.currentGameListSelection.nAppId);for(let t=0;t<4;t++){i.firstChild.innerHTML=`${t}/4`;const n=await a({app_name:e.display_name,app_id:uiStore.currentGameListSelection.nAppId,image_type:t,image_num:0,set_current:!0});if(""!==n){const e=n.split(";",2);SteamClient.Apps.SetCustomArtworkForApp(uiStore.currentGameListSelection.nAppId,e[1],e[0],t)}}i.firstChild.innerHTML="SG",console.log("[steam-easygrid 3] Images replaced for",uiStore.currentGameListSelection.nAppId)}}," Auto replace images "),window.SP_REACT.createElement(t.MenuItem,{onClick:async()=>{y(e)}}," Open window ")),i,{bForcePopup:!0})})}}const i=await c({});if(""!==i){for(const n of e.m_popup.document.querySelectorAll(`*:has(> .${t.findModule(e=>e.ImgSrc).ImgSrc})`))n.style.setProperty("height","auto","important");n.style.setProperty("max-height",i,"important");for(const n of e.m_popup.document.querySelectorAll(`.${t.findModule(e=>e.BoxSizer).BoxSizer} img`))n.style.setProperty("width","50%","important"),n.style.setProperty("height","50%","important"),n.style.setProperty("margin-bottom","100px","important");for(const n of e.m_popup.document.querySelectorAll(`.${t.findModule(e=>e.TitleSection).TitleSection}`))n.style.setProperty("bottom","100px","important")}}async function M(e){if("SP Desktop_uid0"===e.m_strName){for(var i=void 0;!i;){console.log("[steam-easygrid 3] Waiting for MainWindowBrowserManager");try{i=MainWindowBrowserManager}catch{await t.sleep(100)}}console.log("[steam-easygrid 3] Registering callback"),MainWindowBrowserManager.m_browser.on("finished-request",async(i,o)=>{if("/library/home"===MainWindowBrowserManager.m_lastLocation.pathname||MainWindowBrowserManager.m_lastLocation.pathname.startsWith("/library/collection/")||MainWindowBrowserManager.m_lastLocation.pathname.startsWith("/library/app/")){const e=await m({});e>0&&(console.log("[steam-easygrid 3] Staggering page load by",e),await t.sleep(e))}"/library/home"===MainWindowBrowserManager.m_lastLocation.pathname?await async function(e){const i=await g(`div.${t.findModule(e=>e.ShowcaseHeader).ShowcaseHeader}`,e.m_popup.document);if(!i.querySelector("button.easygrid-button")){const o=e.m_popup.document.createElement("div");n.createRoot(o).render(window.SP_REACT.createElement(t.DialogButton,{className:"easygrid-button",style:{width:"50px"}},"SGDB")),i.insertBefore(o,i.firstChild.nextSibling.nextSibling),o.addEventListener("click",async()=>{const e=[];for(let n=0;n<collectionStore.userCollections.length;n++){const i=collectionStore.userCollections[n].m_strId,r=collectionStore.userCollections[n].m_strName;e.push(window.SP_REACT.createElement(t.MenuItem,{onClick:async()=>{const e=collectionStore.GetCollection(i);for(let t=0;t<e.allApps.length;t++){o.firstChild.innerHTML=`Working... (${t}/${e.allApps.length})`;const n=await a({app_name:e.allApps[t].display_name,app_id:e.allApps[t].appid,image_type:0,image_num:0,set_current:!0,is_replace_collection:!0});if(""!==n){const i=n.split(";",2);SteamClient.Apps.SetCustomArtworkForApp(e.allApps[t].appid,i[1],i[0],0)}}o.firstChild.innerHTML="Done!",console.log("[steam-easygrid 3] Grids replaced for",i)}}," Replace grids of ",r," ")),e.push(window.SP_REACT.createElement(t.MenuItem,{onClick:async()=>{const e=collectionStore.GetCollection(i);for(let t=0;t<e.allApps.length;t++)o.firstChild.innerHTML=`Working... (${t}/${e.allApps.length})`,SteamClient.Apps.ClearCustomArtworkForApp(e.allApps[t].appid,0),await a({app_name:e.allApps[t].display_name,app_id:e.allApps[t].appid,image_type:0,image_num:-1,set_current:!0});o.firstChild.innerHTML="Done!",console.log("[steam-easygrid 3] Grids cleared for",i)}}," Reset grids of ",r," "))}t.showContextMenu(window.SP_REACT.createElement(t.Menu,{label:"EasyGrid Options"},e),o,{bForcePopup:!0})})}}(e):MainWindowBrowserManager.m_lastLocation.pathname.startsWith("/library/collection/")?await async function(e){const i=await g(`div.${t.findModule(e=>e.CollectionOptions).CollectionOptions}`,e.m_popup.document);if(!i.querySelector("button.easygrid-button")){const o=e.m_popup.document.createElement("div");n.createRoot(o).render(window.SP_REACT.createElement(t.DialogButton,{className:"easygrid-button",style:{width:"50px"}},"SGDB")),i.insertBefore(o,i.firstChild.nextSibling),o.addEventListener("click",async()=>{t.showContextMenu(window.SP_REACT.createElement(t.Menu,{label:"EasyGrid Options"},window.SP_REACT.createElement(t.MenuItem,{onClick:async()=>{const e=collectionStore.GetCollection(uiStore.currentGameListSelection.strCollectionId);for(let t=0;t<e.allApps.length;t++){o.firstChild.innerHTML=`Working... (${t}/${e.allApps.length})`;const n=await a({app_name:e.allApps[t].display_name,app_id:e.allApps[t].appid,image_type:0,image_num:0,set_current:!0,is_replace_collection:!0});if(""!==n){const i=n.split(";",2);SteamClient.Apps.SetCustomArtworkForApp(e.allApps[t].appid,i[1],i[0],0)}}o.firstChild.innerHTML="Done!",console.log("[steam-easygrid 3] Grids replaced for",uiStore.currentGameListSelection.strCollectionId)}}," Replace grids "),window.SP_REACT.createElement(t.MenuItem,{onClick:async()=>{const e=collectionStore.GetCollection(uiStore.currentGameListSelection.strCollectionId);for(let t=0;t<e.allApps.length;t++)o.firstChild.innerHTML=`Working... (${t}/${e.allApps.length})`,SteamClient.Apps.ClearCustomArtworkForApp(e.allApps[t].appid,0),await a({app_name:e.allApps[t].display_name,app_id:e.allApps[t].appid,image_type:0,image_num:-1,set_current:!0});o.firstChild.innerHTML="Done!",console.log("[steam-easygrid 3] Grids cleared for",uiStore.currentGameListSelection.strCollectionId)}}," Reset grids ")),o,{bForcePopup:!0})})}}(e):MainWindowBrowserManager.m_lastLocation.pathname.startsWith("/library/app/")&&await async function(e){await S(e);const n=await g(`div.${t.findModule(e=>e.TopCapsule).TopCapsule}`,e.m_popup.document);new MutationObserver(async(t,n)=>{await S(e)}).observe(n.parentNode,{subtree:!0,childList:!0,attributes:!0})}(e)})}}return e.default=async function(){console.log("[steam-easygrid 3] frontend startup"),await App.WaitForServicesInitialized();const e=await u({});for(e>0&&(console.log("[steam-easygrid 3] Staggering main load by",e),await t.sleep(e));"undefined"==typeof g_PopupManager||"undefined"==typeof MainWindowBrowserManager;)await t.sleep(100);const n=g_PopupManager.GetExistingPopup("SP Desktop_uid0");n&&M(n),g_PopupManager.AddPopupCreatedCallback(M)},Object.defineProperty(e,"__esModule",{value:!0}),e}({},window.MILLENNIUM_API,window.SP_REACTDOM,window.SP_REACT)};function ExecutePluginModule(){let e=window.MILLENNIUM_PLUGIN_SETTINGS_STORE[pluginName];e.OnPluginConfigChange=function(t,n,i){t in e.settingsStore&&(e.ignoreProxyFlag=!0,e.settingsStore[t]=i,e.ignoreProxyFlag=!1)},MILLENNIUM_BACKEND_IPC.postMessage(0,{pluginName:pluginName,methodName:"__builtins__.__millennium_plugin_settings_parser__"}).then(async t=>{"string"==typeof t.returnValue&&(e.ignoreProxyFlag=!0,e.settingsStore=e.DefinePluginSetting(Object.fromEntries(JSON.parse(atob(t.returnValue)).map(e=>[e.functionName,e]))),e.ignoreProxyFlag=!1);let n=PluginEntryPointMain();Object.assign(window.PLUGIN_LIST[pluginName],{...n,__millennium_internal_plugin_name_do_not_use_or_change__:pluginName});let i=await n.default();var a;i&&(a=i)&&void 0!==a.title&&void 0!==a.icon&&void 0!==a.content?(window.MILLENNIUM_SIDEBAR_NAVIGATION_PANELS[pluginName]=i,MILLENNIUM_BACKEND_IPC.postMessage(1,{pluginName:pluginName})):console.warn(`Plugin ${pluginName} does not contain proper SidebarNavigation props and therefor can't be mounted by Millennium. Please ensure it has a title, icon, and content.`)})}ExecutePluginModule();